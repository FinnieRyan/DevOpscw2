pipeline {
    agent any 

    stages {
	stage('Checkout') {
	    steps {
		git 'https://github.com/FinnieRyan/DevOpscw2.git'
	    }
          }

	  stage('Build Docker image') {
	      steps {
                  script {
                      dockerImage = docker.build("ryanfinnie/cw2-app")
                  }
	      }
          }

          
          stage('Test container') {
              steps {
                  script {
                      dockerImage.inside {
                          //add tests 
                      }
                  }
              }
          }


	  stage('Push to Docker') {
              steps {
                  script {
                      docker.withRegistry('https://registry.hub.docker.com', 'dockerhub-login') {
                          dockerImage.push("latest")
                      }
                  }
              }
          }


	  stage('deploy to Kubernetes') {
	      steps {
                  script {
                   //kubernetes deploy commands 
		  
                  }
              }
          }
      }
  } 
